<!DOCTYPE html>
<html>
  <head>
    <title>WebSSH2</title>
    <style>
      html,
      body {
        background-color: white;
      }
      .dropup-content {
        display: none;
      }
      #connection {
        width: 100%;
        height: 100%;
        border-width: 1px;
        border-style: solid;
        border-color: white;
      }
      #hosts {
        margin: 0px;
        margin-bottom: 5px;
      }
      #hosts li {
        margin: 0px;
        display: inline;
      }
      #host {
        display: inline;
        border-width: 1px;
        border-style: solid;
        border-color: white;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 5px;
        padding-bottom: 5px;
        cursor: pointer;
      }
    </style>
    <link rel="stylesheet" href="/ssh/webssh2.css" />
    <link rel="icon" href="/ssh/favicon.ico" />
  </head>
  <body>
    <div id="hosts-container">
      <ul id="hosts">
      </ul>
    </div>
    <iframe id="connection" class="box" src=""></iframe>
    <script>
      const config = {
        defaults: {
          initCommand: 'bin/tm',
        },
        hosts: [
          {
            label: 'pax',
            host: 'pax.local',
          },
          {
            label: 'padix',
            host: 'padix.local',
          },
          {
            label: 'fixit',
            host: 'fixit.local',
          },
          {
            label: 'rutix',
            host: 'rutix.local',
          },
        ],
      };

      const connection = document.getElementById('connection');
      var currentHostName = '';
      function openConnection(hostName, initialCommand) {
        if (currentHostName) {
          alert(`Session already active to ${currentHostName}`);
        } else {
          var src = `/ssh/host/${hostName}?command=${initialCommand}`;
          connection.src = src;
          currentHostName = hostName;
        }
      }

      //document.addEventListener('load', (event) => {
        const hostEl = document.getElementById('hosts');
        config.hosts.forEach(host => {
          const hostName = host.host;
          if (hostName) {
            const label = host.label || hostName;
            const cmd = host.command || config.defaults.initCommand;
            const hostEntry = `<li><div id="host" onclick="openConnection('${hostName}', '${cmd}')">${label} (${hostName})</div> [<a href="/ssh/host/${hostName}?command=${cmd}" target="${label}">${label}</a>]</li>`;
            hostEl.innerHTML += hostEntry;
          }
        });
      // });
    </script>
  </body>
</html>
